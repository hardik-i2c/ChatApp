(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{121:function(e,t,n){},132:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(29),c=n.n(r),o=n(153),i=n(28),l=n(18),j=n(8),u=n(92),d=n(34),b=n(65),m=n(133),O=n(120),g=n(83),x=n(84),h=n(33),p=n(2),f=Object(u.a)({uri:"http://localhost:4000/"});f=Object(g.a)((function(e,t){var n=t.headers,a=localStorage.getItem("token");return{headers:Object(j.a)(Object(j.a)({},n),{},{auth:a?"Bearer ".concat(a):""})}})).concat(f);var v=new x.a({uri:"ws://localhost:4000/graphql",options:{reconnect:!0,connectionParams:{auth:"Bearer ".concat(localStorage.getItem("token"))}}}),w=Object(d.split)((function(e){var t=e.query,n=Object(h.e)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),v,f),y=new b.a({link:w,cache:new m.a});function S(e){return Object(p.jsx)(O.a,Object(j.a)({client:y},e))}n(121);var N,E=n(21),C=n(27),k=n(148),M=n(87),L=n(155),P=n(156),U=n(37),$=n(158),I=Object(U.a)(N||(N=Object(C.a)(["\n  mutation register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $comfirmPassword: String!\n  ) {\n    register(\n      username: $username\n      email: $email\n      password: $password\n      comfirmPassword: $comfirmPassword\n    ) {\n      username\n      email\n      createdAt\n    }\n  }\n"])));function A(e){var t,n,s,r,c=Object(a.useState)({email:"",username:"",password:"",comfirmPassword:""}),o=Object(E.a)(c,2),l=o[0],u=o[1],d=Object(a.useState)({}),b=Object(E.a)(d,2),m=b[0],O=b[1],g=Object($.a)(I,{update:function(t,n){return e.history.push("/login")},onError:function(e){return O(e.graphQLErrors[0].extensions.errors)}}),x=Object(E.a)(g,2),h=x[0],f=x[1].loading;return Object(p.jsx)(k.a,{className:"bg-white py-5 justify-content-center",children:Object(p.jsxs)(M.a,{sm:8,md:6,lg:4,children:[Object(p.jsx)("h1",{className:"text-center",children:"Register"}),Object(p.jsxs)(L.a,{onSubmit:function(e){e.preventDefault(),h({variables:l})},children:[Object(p.jsxs)(L.a.Group,{className:"mb-3",controlId:"formBasicEmail",children:[Object(p.jsx)(L.a.Label,{className:m.email&&"text-danger",children:null!==(t=m.email)&&void 0!==t?t:"Email address"}),Object(p.jsx)(L.a.Control,{type:"email",className:m.email&&"is-invalid",value:l.email,onChange:function(e){u(Object(j.a)(Object(j.a)({},l),{},{email:e.target.value}))}})]}),Object(p.jsxs)(L.a.Group,{className:"mb-3",controlId:"formBasicUsername",children:[Object(p.jsx)(L.a.Label,{className:m.username&&"text-danger",children:null!==(n=m.username)&&void 0!==n?n:"Username"}),Object(p.jsx)(L.a.Control,{type:"text",className:m.username&&"is-invalid",value:l.username,onChange:function(e){u(Object(j.a)(Object(j.a)({},l),{},{username:e.target.value}))}})]}),Object(p.jsxs)(L.a.Group,{className:"mb-3",controlId:"formBasicPassword",children:[Object(p.jsx)(L.a.Label,{className:m.password&&"text-danger",children:null!==(s=m.password)&&void 0!==s?s:"Password"}),Object(p.jsx)(L.a.Control,{type:"password",className:m.password&&"is-invalid",value:l.password,onChange:function(e){u(Object(j.a)(Object(j.a)({},l),{},{password:e.target.value}))}})]}),Object(p.jsxs)(L.a.Group,{className:"mb-3",controlId:"formBasicCpassword",children:[Object(p.jsx)(L.a.Label,{className:m.comfirmPassword&&"text-danger",children:null!==(r=m.comfirmPassword)&&void 0!==r?r:"Comfirm Password"}),Object(p.jsx)(L.a.Control,{type:"password",className:m.comfirmPassword&&"is-invalid",value:l.comfirmPassword,onChange:function(e){u(Object(j.a)(Object(j.a)({},l),{},{comfirmPassword:e.target.value}))}})]}),Object(p.jsxs)("div",{className:"text-center",children:[Object(p.jsx)(P.a,{variant:"success",type:"submit",disabled:f,children:f?"loading..":"Register"}),Object(p.jsx)("br",{}),Object(p.jsxs)("small",{children:["Already have an account. ",Object(p.jsx)(i.b,{to:"/login",children:"Login"})]})]})]})]})})}var D=n(149),G=n(89),R=Object(a.createContext)(),_=Object(a.createContext)(),T=null,B=localStorage.getItem("token");if(B){var Y=Object(G.a)(B),q=new Date(1e3*Y.exp);new Date>q?localStorage.removeItem("token"):T=Y}else console.log("token not present.");var F,J=function(e,t){switch(t.type){case"LOGIN":return localStorage.setItem("token",t.payload.token),Object(j.a)(Object(j.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(j.a)(Object(j.a)({},e),{},{user:null});default:throw new Error("Unknown action type: ".concat(t.type))}},Q=function(e){var t=e.children,n=Object(a.useReducer)(J,{user:T}),s=Object(E.a)(n,2),r=s[0],c=s[1];return Object(p.jsx)(_.Provider,{value:c,children:Object(p.jsx)(R.Provider,{value:r,children:t})})},z=function(){return Object(a.useContext)(R)},H=function(){return Object(a.useContext)(_)},K=Object(U.a)(F||(F=Object(C.a)(["\n  query login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      username\n      email\n      token\n      createdAt\n    }\n  }\n"])));function V(e){var t,n,s=Object(a.useState)({username:"",password:""}),r=Object(E.a)(s,2),c=r[0],o=r[1],l=Object(a.useState)({}),u=Object(E.a)(l,2),d=u[0],b=u[1],m=H(),O=Object(D.a)(K,{onError:function(e){return b(e.graphQLErrors[0].extensions.errors)},onCompleted:function(e){m({type:"LOGIN",payload:e.login}),window.location.href="/"}}),g=Object(E.a)(O,2),x=g[0],h=g[1].loading;return Object(p.jsx)(k.a,{className:"bg-white py-5 justify-content-center",children:Object(p.jsxs)(M.a,{sm:8,md:6,lg:4,children:[Object(p.jsx)("h1",{className:"text-center",children:"Login"}),Object(p.jsxs)(L.a,{onSubmit:function(e){e.preventDefault(),x({variables:c})},children:[Object(p.jsxs)(L.a.Group,{className:"mb-3",controlId:"formBasicUsername",children:[Object(p.jsx)(L.a.Label,{className:(null===d||void 0===d?void 0:d.username)&&"text-danger",children:null!==(t=d.username)&&void 0!==t?t:"Username"}),Object(p.jsx)(L.a.Control,{type:"text",className:(null===d||void 0===d?void 0:d.username)&&"is-invalid",value:c.username,onChange:function(e){o(Object(j.a)(Object(j.a)({},c),{},{username:e.target.value}))}})]}),Object(p.jsxs)(L.a.Group,{className:"mb-3",controlId:"formBasicPassword",children:[Object(p.jsx)(L.a.Label,{className:(null===d||void 0===d?void 0:d.password)&&"text-danger",children:null!==(n=d.password)&&void 0!==n?n:"Password"}),Object(p.jsx)(L.a.Control,{type:"password",className:(null===d||void 0===d?void 0:d.password)&&"is-invalid",value:c.password,onChange:function(e){o(Object(j.a)(Object(j.a)({},c),{},{password:e.target.value}))}})]}),Object(p.jsxs)("div",{className:"text-center",children:[Object(p.jsx)(P.a,{variant:"success",type:"submit",disabled:h,children:h?"loading..":"Login"}),Object(p.jsx)("br",{}),Object(p.jsxs)("small",{children:["Don't have an account ? ",Object(p.jsx)(i.b,{to:"/register",children:"Register"})]})]})]})]})})}var W,X=n(58),Z=Object(a.createContext)(),ee=Object(a.createContext)(),te=function(e,t){var n,a,s=t.payload,r=s.username,c=s.message,o=s.messages;switch(t.type){case"SET_USER":return Object(j.a)(Object(j.a)({},e),{},{users:t.payload});case"SET_USER_MESSAGES":return a=(n=Object(X.a)(e.users)).findIndex((function(e){return e.username===r})),n[a]=Object(j.a)(Object(j.a)({},n[a]),{},{messages:o}),Object(j.a)(Object(j.a)({},e),{},{users:n});case"SET_SELECTED_USER":return n=e.users.map((function(e){return Object(j.a)(Object(j.a)({},e),{},{selected:e.username===t.payload})})),Object(j.a)(Object(j.a)({},e),{},{users:n});case"ADD_MESSAGE":a=(n=Object(X.a)(e.users)).findIndex((function(e){return e.username===r}));var i=Object(j.a)(Object(j.a)({},n[a]),{},{messages:n[a].messages?[c].concat(Object(X.a)(n[a].messages)):null,latestMessage:c});return n[a]=i,Object(j.a)(Object(j.a)({},e),{},{users:n});default:throw new Error("Unknown action type: ".concat(t.type))}},ne=function(e){var t=e.children,n=Object(a.useReducer)(te,{users:null}),s=Object(E.a)(n,2),r=s[0],c=s[1];return Object(p.jsx)(ee.Provider,{value:c,children:Object(p.jsx)(Z.Provider,{value:r,children:t})})},ae=function(){return Object(a.useContext)(Z)},se=function(){return Object(a.useContext)(ee)},re=n(159),ce=n(150),oe=n(151),ie=n(5),le=n.n(ie),je=Object(U.a)(W||(W=Object(C.a)(["\n  query getUser {\n    getUsers {\n      username\n      createdAt\n      imageUrl\n      latestMessage {\n        uuid\n        from\n        to\n        createdAt\n        content\n      }\n    }\n  }\n"])));function ue(){var e,t,n=se(),a=ae().users,s=null===a||void 0===a||null===(e=a.find((function(e){return!0===e.selected})))||void 0===e?void 0:e.username,r=Object(ce.a)(je,{onCompleted:function(e){return n({type:"SET_USER",payload:e.getUsers})},onError:function(e){return console.log(e)}}).loading;return!a||r?t=Object(p.jsx)("p",{children:"Loading..."}):0===a.length?t=Object(p.jsx)("p",{children:"No users join the chat."}):a.length>0&&(t=a.map((function(e){var t=s===e.username;return Object(p.jsxs)("div",{role:"button",className:le()("user-div d-flex justify-content-center justify-content-md-start p-3 ",{"bg-white":t}),onClick:function(){n({type:"SET_SELECTED_USER",payload:e.username})},children:[Object(p.jsx)(oe.a,{src:e.imageUrl||"https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y",className:"user-image"}),Object(p.jsxs)("div",{className:"d-none d-md-block ml-2",children:[Object(p.jsx)("p",{className:"text-success",children:e.username}),Object(p.jsx)("p",{className:"font-weight-light",children:e.latestMessage?e.latestMessage.content:"You are not connected."})]})]},e.username)}))),Object(p.jsx)(M.a,{xs:2,md:4,className:"user-data bg-secondary p-0",children:t})}var de,be,me=n(90),Oe=n.n(me),ge=n(154),xe=n(152);function he(e){var t=e.message,n=z().user,a=t.from===n.username,s=!a;return Object(p.jsx)(ge.a,{placement:a?"right":"left",overlay:Object(p.jsx)(xe.a,{children:Oe()(t.createdAt).format("MMMM DD, YYYY @ h:mm a")}),transition:!1,children:Object(p.jsx)("div",{className:le()("d-flex my-3",{"ml-auto":a,"mr-auto":s}),children:Object(p.jsx)("div",{className:le()("py-2 px-3 rounded-pill",{"bg-primary":a,"bg-secondary":s}),children:Object(p.jsx)("p",{className:le()({"text-white":a}),children:t.content},t.uuid)})})})}var pe,fe=Object(U.a)(de||(de=Object(C.a)(["\n  mutation sendMessage($to: String!, $content: String!) {\n    sendMessage(to: $to, content: $content) {\n      uuid\n      from\n      to\n      content\n      createdAt\n    }\n  }\n"]))),ve=Object(U.a)(be||(be=Object(C.a)(["\n  query getMessages($from: String!) {\n    getMessages(from: $from) {\n      uuid\n      from\n      to\n      content\n      createdAt\n    }\n  }\n"])));function we(){var e=ae().users,t=se(),n=Object(a.useState)(""),s=Object(E.a)(n,2),r=s[0],c=s[1],o=null===e||void 0===e?void 0:e.find((function(e){return!0===e.selected})),i=null===o||void 0===o?void 0:o.messages,l=Object(D.a)(ve),j=Object(E.a)(l,2),u=j[0],d=j[1],b=d.loading,m=d.data,O=Object($.a)(fe,{onError:function(e){return console.log(e)}}),g=Object(E.a)(O,1)[0];Object(a.useEffect)((function(){o&&!o.messages&&u({variables:{from:o.username}})}),[o]),Object(a.useEffect)((function(){m&&t({type:"SET_USER_MESSAGES",payload:{username:o.username,messages:m.getMessages}})}),[m]);var x,h=function(e){e.preventDefault(),""!==r.trim()&&o&&(c(""),g({variables:{to:o.username,content:r}}))};return i||b?b?x=Object(p.jsx)("p",{className:"info-text",children:"Loading.."}):i.length>0?x=i.map((function(e,t){return Object(p.jsxs)(a.Fragment,{children:[Object(p.jsx)(he,{message:e}),t===i.length-1&&Object(p.jsx)("div",{className:"invisible",children:Object(p.jsx)("hr",{className:"m-0"})})]},e.uuid)})):0===i.length&&(x=Object(p.jsx)("p",{className:"info-text",children:"You are now connected! send your first message!"})):x=Object(p.jsx)("p",{className:"info-text",children:"Select a friend"}),Object(p.jsxs)(M.a,{xs:10,md:8,children:[Object(p.jsx)("div",{className:"messages-box d-flex flex-column-reverse",children:x}),Object(p.jsx)("div",{children:Object(p.jsx)(L.a,{onSubmit:h,children:Object(p.jsxs)(L.a.Group,{className:"d-flex align-items-center",children:[Object(p.jsx)(L.a.Control,{type:"text",className:"message-input rounded-pill p-4 bg-secondary border-0",placeholder:"Type a message..",value:r,onChange:function(e){return c(e.target.value)}}),Object(p.jsx)("i",{className:"fas fa-paper-plane fa-2x text-primary ml-2",onClick:h,role:"button"})]})})})]})}var ye=Object(U.a)(pe||(pe=Object(C.a)(["\n  subscription newMessage {\n    newMessage {\n      uuid\n      from\n      to\n      content\n      createdAt\n    }\n  }\n"])));function Se(){var e=H(),t=se(),n=z().user,s=Object(re.a)(ye),r=s.data,c=s.error;Object(a.useEffect)((function(){if(c&&console.log(c),r){var e=r.newMessage,a=n.username===e.to?e.from:e.to;t({type:"ADD_MESSAGE",payload:{username:a,message:r.newMessage}})}}),[c,r]);return Object(p.jsxs)(a.Fragment,{children:[Object(p.jsxs)(k.a,{className:"bg-white justify-content-around mb-2",children:[Object(p.jsx)(i.b,{to:"/login",children:Object(p.jsx)(P.a,{variant:"link",children:"Login"})}),Object(p.jsx)(i.b,{to:"/register",children:Object(p.jsx)(P.a,{variant:"link",children:"Register"})}),Object(p.jsx)(P.a,{variant:"link",onClick:function(){e({type:"LOGOUT"}),localStorage.removeItem("token"),window.location.href="/login"},children:"Logout"})]}),Object(p.jsxs)(k.a,{className:"bg-white ",children:[Object(p.jsx)(ue,{}),Object(p.jsx)(we,{})]})]})}function Ne(e){var t=z().user;return e.authenticated&&!t?Object(p.jsx)(l.a,{to:"/login"}):e.guest&&t?Object(p.jsx)(l.a,{to:"/"}):Object(p.jsx)(l.b,Object(j.a)({component:e.component},e))}var Ee=function(){return Object(p.jsx)(Q,{children:Object(p.jsx)(ne,{children:Object(p.jsx)(S,{children:Object(p.jsx)(i.a,{children:Object(p.jsx)(o.a,{className:"pt-4",children:Object(p.jsxs)(l.d,{children:[Object(p.jsx)(Ne,{exact:!0,path:"/",component:Se,authenticated:!0}),Object(p.jsx)(Ne,{path:"/register",component:A,guest:!0}),Object(p.jsx)(Ne,{path:"/login",component:V,guest:!0})]})})})})})})};c.a.render(Object(p.jsx)(s.a.StrictMode,{children:Object(p.jsx)(Ee,{})}),document.getElementById("root"))}},[[132,1,2]]]);
//# sourceMappingURL=main.9c78595e.chunk.js.map